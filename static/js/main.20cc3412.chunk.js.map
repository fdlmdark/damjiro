{"version":3,"sources":["MIDIPlayer.js","util/MIDILoader.js","MIDIFilePicker.js","shared/MessageSnackbar.js","App.js","reducers/SnackbarReducer.js","serviceWorker.js","index.js"],"names":["getFirstEffectiveMIDIEvent","midiBuf","ons","MIDIFile","getMidiEvents","filter","ev","subtype","MIDIEvents","EVENT_MIDI_NOTE_ON","length","Error","PCMPlayer","audioContext","pcm","_audioContext","_pcm","_playing","_currentTime","_offset","_epoch","_onAudioProcess","bind","this","_node","createScriptProcessor","numChannels","connect","destination","addEventListener","emit","disconnect","removeEventListener","e","bufsize","ch","out","outputBuffer","getChannelData","i","si","s","data","currentTime","stop","EventEmitter","MIDIPlayer","buffer","onReady","onPlay","onEnd","useState","setAudioContext","pcmPlayer","setPCMPlayer","isPlaying","setIsPlaying","refOnReady","useRef","refOnPlay","refOnEnd","useEffect","AudioContext","close","a","synth","JSLibTimidity","window","location","pathname","sampleRate","isReady","Promise","r","setTimeout","midi2wav","Uint8Array","pcmWoRest","restLength","playTime","Int16Array","set","player","current","target","on","oldPlayer","f","type","onClick","play","MIDILoader","file","onLoad","dispatch","includes","reader","FileReader","onload","result","readAsArrayBuffer","message","variant","toString","MIDIFilePicker","accept","onChange","files","variantIcon","success","CheckCircle","warning","Warning","error","info","Info","useStyles","makeStyles","theme","backgroundColor","green","palette","dark","primary","main","amber","icon","fontSize","iconVariant","opacity","marginRight","spacing","display","alignItems","MessageSnackbar","snack","openSnack","customTag","handleClose","classes","Object","keys","Icon","Snackbar","anchorOrigin","vertical","horizontal","open","onClose","SnackbarContent","className","clsx","aria-describedby","id","action","IconButton","key","aria-label","color","Close","round","num","base","Math","floor","lower_bound","ary","cmp","begin","end","len","half","mid","impl","midi2notes","targetTrack","targetChannel","midi","header","getFormat","getTracksCount","getTimeDivision","Header","TICKS_PER_BEAT","notes_begin","notes_end","events","channel","push","param1","EVENT_MIDI_NOTE_OFF","notes","b","tpos","duration","pitch","gakufu2json","gNotes","youtubeVideoId","timeOffset","gakufu","map","n","JSON","stringify","createPitchDetector","navigator","mediaDevices","getUserMedia","audio","video","stream","resolve","pitchHandler","ml5","pitchDetection","getPitch","reject","err","freq","m","log","stopAudio","getTracks","forEach","track","NotesSVG","styled","svg","NotesDisplay","start","step","curtpos","uNotes","seconds","cw","tpos2x","tpos2x_view","notes2bars","note","reduce","acc","last","abs","concat","Fragment","x","y","width","height","rx","ry","fill","fillOpacity","viewBox","preserveAspectRatio","x1","x2","y1","y2","strokeWidth","stroke","Array","from","_","correct","InputDamjiroGakufu","gakufuText","setGakufuText","errorMsg","setErrorMsg","value","json","parse","videoId","String","isNaN","TimeOffsetForm","Number","required","PitchOffsetForm","pitchOffset","NotesScroller","user","playing","curTimeOffset","curPitchOffset","setCurtpos","useCallback","timerAdjust","setInterval","getCurrentTime","prev","getBiasedVideoTime","now","biasedPitch","lbIdx","lb","gap","clearInterval","onPause","ScoreDisplay","score","uNote","gNote","loss","sum","MIDIEditor","fileBody","setFileBody","trackNo","setTrackNo","channelNo","setChannelNo","introTime","setIntroTime","setPitchOffset","setYoutubeVideoId","setVideo","gNotesOriginal","epoch","makeNotesSensible","estimatedIntroTime","seekTo","readOnly","playVideo","pauseVideo","rootReducer","combineReducers","state","persistReducer","storage","whitelist","loadSnack","console","persistedReducer","store","createStore","persistor","persistStore","App","loading","CssBaseline","buf","Boolean","hostname","match","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","then","registration","unregister","catch"],"mappings":"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","file":"static/js/main.20cc3412.chunk.js","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\nimport JSLibTimidity from 'js-libtimidity'\nimport EventEmitter from 'events'\nimport MIDIFile from 'midifile'\nimport MIDIEvents from 'midievents'\n\nconst TIMIDITY_CFG = `\nsoundfont GeneralUserGSv1.471.sf2\n`\n\nfunction getFirstEffectiveMIDIEvent (midiBuf) {\n  const midi = new MIDIFile(midiBuf)\n  const events = midi.getMidiEvents()\n  const ons = events.filter(ev => ev.subtype === MIDIEvents.EVENT_MIDI_NOTE_ON)\n  if (ons.length === 0) throw new Error('invalid midi file')\n  return ons[0]\n}\n\nclass PCMPlayer extends EventEmitter {\n  constructor (audioContext, pcm) {\n    super()\n    this._audioContext = audioContext\n    this._pcm = pcm\n    this._playing = false\n    this._currentTime = 0\n    this._offset = 0\n    this._epoch = null\n    this._onAudioProcess = this._onAudioProcess.bind(this)\n  }\n\n  play () {\n    if (this._playing) return\n\n    this._node = this._audioContext.createScriptProcessor(\n      0,\n      0,\n      this._pcm.numChannels\n    )\n    this._node.connect(this._audioContext.destination)\n    this._node.addEventListener('audioprocess', this._onAudioProcess)\n\n    this._playing = true\n    this.emit('start')\n  }\n\n  stop () {\n    if (!this._playing) return\n\n    this._node.disconnect()\n    this._node.removeEventListener('audioprocess', this._onAudioProcess)\n\n    this._playing = false\n    this._pcm = null\n    this.emit('end')\n  }\n\n  _onAudioProcess (e) {\n    let bufsize = 0\n    for (let ch = 0; ch < this._pcm.numChannels; ch++) {\n      const out = e.outputBuffer.getChannelData(ch)\n      bufsize = out.length\n      for (let i = 0; i < bufsize; i++) {\n        const si = (this._offset + i) * this._pcm.numChannels + ch\n        const s = si < this._pcm.data.length ? this._pcm.data[si] / 0x7fff : 0\n        out[i] = s\n      }\n    }\n    this._offset += bufsize\n\n    if (!this._epoch) this._epoch = this._audioContext.currentTime\n\n    if (\n      this._playing &&\n      this._offset * this._pcm.numChannels > this._pcm.data.length\n    )\n      this.stop()\n  }\n\n  getCurrentTime () {\n    if (!this._epoch) return 0\n    return this._audioContext.currentTime - this._epoch\n  }\n}\n\nfunction MIDIPlayer ({ buffer, onReady, onPlay, onEnd }) {\n  const [audioContext, setAudioContext] = useState(null)\n  const [pcmPlayer, setPCMPlayer] = useState(null)\n  const [isPlaying, setIsPlaying] = useState(false)\n  const refOnReady = useRef(onReady)\n  const refOnPlay = useRef(onPlay)\n  const refOnEnd = useRef(onEnd)\n\n  useEffect(() => {\n    const audioContext = new AudioContext()\n    setAudioContext(audioContext)\n    return () => {\n      audioContext.close()\n    }\n  }, [])\n  useEffect(() => {\n    if (!audioContext || !buffer) return\n    async function f () {\n      const synth = new JSLibTimidity(window.location.pathname, TIMIDITY_CFG, {\n        sampleRate: audioContext.sampleRate,\n        numChannels: 2\n      })\n      while (!synth.isReady()) await new Promise(r => setTimeout(r, 1000))\n      let pcmWoRest = await synth.midi2wav(new Uint8Array(buffer))\n\n      // Prefix 'rest' to pcmWoRest\n      // c.f.: https://superuser.com/questions/737036/timidity-extract-tracks-preserving-initial-silence\n      const restLength =\n        (getFirstEffectiveMIDIEvent(buffer).playTime / 1000) *\n        pcmWoRest.sampleRate *\n        pcmWoRest.numChannels\n      const pcm = {\n        ...pcmWoRest,\n        data: new Int16Array(restLength + pcmWoRest.data.length)\n      }\n      pcm.data.set(pcmWoRest.data, restLength)\n\n      const player = new PCMPlayer(audioContext, pcm)\n      if (refOnReady.current) refOnReady.current({ target: player })\n      player.on('start', () => {\n        if (refOnPlay.current) refOnPlay.current()\n        setIsPlaying(true)\n      })\n      player.on('end', () => {\n        if (refOnEnd.current) refOnEnd.current()\n        setIsPlaying(false)\n      })\n      setPCMPlayer(oldPlayer => {\n        if (oldPlayer) oldPlayer.stop()\n        return player\n      })\n    }\n    f()\n  }, [buffer, audioContext])\n\n  refOnReady.current = onReady\n  refOnPlay.current = onPlay\n  refOnEnd.current = onEnd\n\n  return (\n    <div>\n      {pcmPlayer && !isPlaying && (\n        <button type='button' onClick={e => pcmPlayer.play()}>\n          Play\n        </button>\n      )}\n    </div>\n  )\n}\n\nexport default MIDIPlayer\n","const MIDILoader = (file, onLoad, dispatch) => {\n  try {\n    if (!['audio/midi', 'audio/x-midi', 'audio/mid'].includes(file.type)) {\n      dispatch({\n        type: 'SNACK_LOAD',\n        message: 'Invalid mime type',\n        variant: 'error'\n      })\n    } else {\n      const reader = new FileReader()\n      reader.onload = e => onLoad(e.target.result)\n      reader.readAsArrayBuffer(file)\n    }\n  } catch (e) {\n    dispatch({ type: 'SNACK_LOAD', message: e.toString(), variant: 'error' })\n  }\n}\nexport default MIDILoader\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport MIDILoader from './util/MIDILoader'\n\nfunction MIDIFilePicker ({ onLoad, dispatch }) {\n  return (\n    <input\n      type='file'\n      accept='audio/midi, audio/x-midi, audio/mid'\n      onChange={e => {\n        // Read the file\n        const file = e.target.files[0]\n        MIDILoader(file, onLoad, dispatch)\n      }}\n    />\n  )\n}\nMIDIFilePicker = connect()(MIDIFilePicker)\nexport default MIDIFilePicker\n","import {\n  IconButton,\n  makeStyles,\n  Snackbar,\n  SnackbarContent\n} from '@material-ui/core'\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport { CheckCircle, Close, Error, Info, Warning } from '@material-ui/icons'\nimport { amber, green } from '@material-ui/core/colors'\nimport clsx from 'clsx'\n\n/**\n * Show snackbar with custom message from Redux.\n * How to use:\n * 1. Connect your component with dispatch. For example:\n * ```\n * const _yourComponent = (dispatch) => {\n *\n * }\n * const YourComponent()(_yourComponent);\n * ```\n * 2. Use dispatch() when you want to show messages with snackbar.\n * `dispatch({type: 'SNACK_LOAD', message: 'some Message', variant: 'error'})`\n *\n * @param openSnack\n *  from redux. no need to config.\n * @param variant default 'info'\n *  from redux, need to config. you can choose one of 'error', 'info', 'success', 'warning'.\n * @param message\n *  from redux, need to config.\n * @param dispatch\n *  from redux.\n * @param customTag\n *  you can customize Snackbar from material UI. add some tag implemented Snackbar.\n * @returns <Snackbar />\n */\n\nexport const variantIcon = {\n  success: CheckCircle,\n  warning: Warning,\n  error: Error,\n  info: Info\n}\n\nconst useStyles = makeStyles(theme => ({\n  success: {\n    backgroundColor: green[600]\n  },\n  error: {\n    backgroundColor: theme.palette.error.dark\n  },\n  info: {\n    backgroundColor: theme.palette.primary.main\n  },\n  warning: {\n    backgroundColor: amber[700]\n  },\n  icon: {\n    fontSize: 20\n  },\n  iconVariant: {\n    opacity: 0.9,\n    marginRight: theme.spacing(1)\n  },\n  message: {\n    display: 'flex',\n    alignItems: 'center'\n  }\n}))\n\nconst _messageSnackbar = ({\n  openSnack,\n  variant,\n  message,\n  dispatch,\n  ...customTag\n}) => {\n  const handleClose = () => dispatch({ type: 'SNACK_UNLOAD' })\n  const classes = useStyles()\n  variant = Object.keys(variantIcon).includes(variant) ? variant : 'info'\n  const Icon = variantIcon[variant]\n\n  return (\n    <Snackbar\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'center'\n      }}\n      open={openSnack}\n      onClose={handleClose}\n      {...customTag}\n    >\n      <SnackbarContent\n        className={clsx(classes[variant])}\n        aria-describedby='snackbar'\n        message={\n          <span id='snackbar' className={classes.message}>\n            <Icon className={clsx(classes.icon, classes.iconVariant)} />\n            {message}\n          </span>\n        }\n        action={[\n          <IconButton\n            key='close'\n            aria-label='close'\n            color='inherit'\n            onClick={handleClose}\n          >\n            <Close className={classes.icon} />\n          </IconButton>\n        ]}\n      />\n    </Snackbar>\n  )\n}\nconst MessageSnackbar = connect(\n  ({ snack: { openSnack, variant, message } }) => ({\n    openSnack,\n    variant,\n    message\n  })\n)(_messageSnackbar)\nexport default MessageSnackbar\n","import React, { useRef, useState, useCallback, useEffect } from 'react'\nimport { combineReducers, createStore } from 'redux'\nimport { Provider, connect } from 'react-redux'\nimport styled from 'styled-components'\nimport YouTube from 'react-youtube'\nimport { persistStore, persistReducer } from 'redux-persist'\nimport storage from 'redux-persist/lib/storage'\nimport { PersistGate } from 'redux-persist/integration/react'\nimport ml5 from 'ml5'\nimport MIDIFile from 'midifile'\nimport MIDIEvents from 'midievents'\nimport MIDIPlayer from './MIDIPlayer'\nimport MIDIFilePicker from './MIDIFilePicker'\nimport snackbarReducer from './reducers/SnackbarReducer'\nimport MessageSnackbar from './shared/MessageSnackbar'\nimport MIDILoader from './util/MIDILoader'\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\n// Thanks to: https://stackoverflow.com/questions/4059147/check-if-a-variable-is-a-string-in-javascript\nfunction isString (s) {\n  return typeof s === 'string' || s instanceof String\n}\n\nfunction isNumber (n) {\n  return !isNaN(n)\n}\n\nfunction sec2us (n) {\n  return n * 1000000\n}\n\nfunction isClose (a, b) {\n  return Math.abs(a - b) < 0.0001\n}\n\nfunction round (num, base) {\n  return Math.floor(num / base) * base\n}\n\nfunction range (start, stop, step) {\n  return Array.from(\n    { length: (stop - start) / step + 1 },\n    (_, i) => start + i * step\n  )\n}\n\n// c.f. C++'s std::lower_bound\n// Thanks to: https://cpprefjp.github.io/reference/algorithm/lower_bound.html\nfunction lower_bound (ary, cmp) {\n  const impl = (begin, end) => {\n    for (let len = end - begin; len !== 0; ) {\n      const half = Math.floor(len / 2)\n      const mid = begin + half\n      if (cmp(ary[mid])) {\n        len -= half + 1\n        begin = mid + 1\n      } else {\n        len = half\n      }\n    }\n    return begin\n  }\n  return impl(0, ary.length)\n}\n\nfunction midi2notes (buffer, targetTrack, targetChannel) {\n  const midi = new MIDIFile(buffer)\n  if (midi.header.getFormat() === 2)\n    throw new Error('Unsupported format of MIDI')\n  if (midi.header.getTracksCount() === 0) throw new Error('Not enough tracks')\n  if (midi.header.getTimeDivision() !== MIDIFile.Header.TICKS_PER_BEAT)\n    throw new Error('Unsupported time division')\n\n  const notes_begin = []\n  const notes_end = []\n  const events = midi.getMidiEvents()\n  for (let ev of events) {\n    if (ev.channel !== targetChannel) continue\n\n    switch (ev.subtype) {\n      case MIDIEvents.EVENT_MIDI_NOTE_ON:\n        if (notes_begin.length !== notes_end.length) break\n        notes_begin.push([ev.playTime * 1000, ev.param1])\n        break\n\n      case MIDIEvents.EVENT_MIDI_NOTE_OFF:\n        if (\n          notes_begin.length - notes_end.length !== 1 ||\n          notes_begin[notes_begin.length - 1][1] !== ev.param1\n        )\n          break\n        notes_end.push([ev.playTime * 1000, ev.param1])\n        break\n\n      default:\n        break\n    }\n  }\n  if (notes_begin.length !== notes_end.length)\n    throw new Error('Invalid # of note offs')\n\n  const notes = []\n  for (let i = 0; i < notes_begin.length; i++) {\n    const b = notes_begin[i]\n    const e = notes_end[i]\n    notes.push({\n      tpos: b[0],\n      duration: e[0] - b[0],\n      pitch: b[1]\n    })\n  }\n\n  return notes\n}\n\nfunction makeNotesSensible (notes, introTime, pitchOffset) {\n  if (notes.length === 0) return notes\n\n  const epoch = notes[0].tpos\n  return notes.map(n => ({\n    tpos: n.tpos - epoch + introTime,\n    duration: n.duration,\n    pitch: n.pitch + pitchOffset\n  }))\n}\n\nfunction gakufu2json (gNotes, youtubeVideoId, timeOffset) {\n  const gakufu = {\n    notes: gNotes.map(n => [\n      Math.round(n.tpos),\n      Math.round(n.duration),\n      Math.round(n.pitch)\n    ]),\n    youtubeVideoId,\n    timeOffset\n  }\n  return JSON.stringify(gakufu)\n}\n\nasync function createPitchDetector () {\n  const audioContext = new AudioContext()\n  const stream = await navigator.mediaDevices.getUserMedia({\n    audio: true,\n    video: false\n  })\n\n  const pitchHandler = await new Promise(resolve => {\n    const pitchHandler = ml5.pitchDetection(\n      './model',\n      audioContext,\n      stream,\n      () => {\n        resolve(pitchHandler)\n      }\n    )\n  })\n\n  const getPitch = () =>\n    new Promise((resolve, reject) =>\n      pitchHandler.getPitch((err, freq) => {\n        if (err) reject(err)\n        if (!freq) resolve(null)\n        const m = Math.round(12 * (Math.log(freq / 440) / Math.log(2))) + 69\n        resolve(m)\n      })\n    )\n  const stopAudio = () => {\n    stream.getTracks().forEach(track => track.stop())\n    audioContext.close()\n  }\n\n  return [getPitch, stopAudio]\n}\n\nconst NotesSVG = styled.svg`\n  width: 80vw;\n  height: 80vh;\n`\nfunction NotesDisplay ({ curtpos, gNotes, uNotes, seconds }) {\n  // curtpos, tpos, duration in us\n  // pitch in SMF\n\n  const SIZE_PER_SEC = 100\n  const cw = SIZE_PER_SEC * seconds\n  const ch = 500\n  const tpos2x = tpos => (tpos * SIZE_PER_SEC) / 1000000\n  const r = {\n    from: round(tpos2x(curtpos), cw),\n    to: round(tpos2x(curtpos), cw) + cw\n  }\n  const tpos2x_view = tpos => tpos2x(tpos) - r.from\n\n  const notes2bars = (notes, color) =>\n    notes\n      .filter(\n        note =>\n          r.from < tpos2x(note.tpos + note.duration) && tpos2x(note.tpos) < r.to\n      )\n      .reduce((acc, note) => {\n        // Concat close notes at same pitch\n        if (acc.length === 0) return [note]\n        const last = acc[acc.length - 1]\n        if (\n          last.pitch !== note.pitch ||\n          !isClose(last.tpos + last.duration, note.tpos)\n        )\n          return acc.concat(note)\n        acc[acc.length - 1] = {\n          tpos: last.tpos,\n          duration: note.tpos + note.duration - last.tpos,\n          pitch: last.pitch\n        }\n        return acc\n      }, [])\n      .map(note => (\n        <React.Fragment key={note.tpos}>\n          <rect\n            x={tpos2x_view(note.tpos)}\n            y={500 - note.pitch * 5}\n            width={tpos2x(note.duration)}\n            height={5}\n            rx={1}\n            ry={1}\n            fill={color}\n            fillOpacity={0.7}\n          />\n        </React.Fragment>\n      ))\n\n  return (\n    <>\n      <p>{curtpos}</p>\n      <NotesSVG viewBox={'0,0,' + cw + ',' + ch} preserveAspectRatio='none'>\n        {\n          // horizontal lines\n        }\n        <line x1={0} x2={cw} y1={0} y2={0} strokeWidth={5} stroke='gray' />\n        <line x1={0} x2={cw} y1={ch} y2={ch} strokeWidth={5} stroke='gray' />\n        {// vertical lines\n        range(0, cw, SIZE_PER_SEC).map(x => (\n          <line\n            key={x}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={ch}\n            strokeWidth={1}\n            stroke='gray'\n            fillOpacity={0.7}\n          />\n        ))}\n        <line\n          x1={tpos2x_view(curtpos)}\n          x2={tpos2x_view(curtpos)}\n          y1={0}\n          y2={ch}\n          strokeWidth={1}\n          stroke='red'\n        />\n        {// note bars\n        notes2bars(gNotes, 'gray')}\n        {// user's correct note bars\n        notes2bars(\n          uNotes.filter(n => n.correct),\n          '#FFA500'\n        )}\n        {// user's wrong note bars\n        notes2bars(\n          uNotes.filter(n => !n.correct),\n          'red'\n        )}\n      </NotesSVG>\n    </>\n  )\n}\n\nfunction InputDamjiroGakufu ({ dispatch }) {\n  const [gakufuText, setGakufuText] = useState('')\n  const [errorMsg, setErrorMsg] = useState(null)\n\n  return (\n    <div>\n      <textarea\n        value={gakufuText}\n        onChange={e => {\n          setGakufuText(e.target.value)\n          try {\n            const json = JSON.parse(e.target.value)\n            const notes = json.notes.map(n => ({\n              tpos: n[0],\n              duration: n[1],\n              pitch: n[2]\n            }))\n            const videoId = json.youtubeVideoId\n            const timeOffset = json.timeOffset\n            if (!isString(videoId) || !isNumber(timeOffset)) {\n              dispatch({\n                type: 'SNACK_LOAD',\n                message: 'invalid JSON',\n                variant: 'error'\n              })\n            } else {\n              dispatch({ type: 'SET_GAKUFU', gakufu: { notes, videoId } })\n              dispatch({ type: 'SET_USER_TIME_OFFSET', value: timeOffset })\n              setErrorMsg(null)\n            }\n          } catch (e) {\n            dispatch({ type: 'RESET_GAKUFU' })\n            setErrorMsg(e.message)\n            dispatch({\n              type: 'SNACK_LOAD',\n              message: e.message,\n              variant: 'error'\n            })\n          }\n          dispatch({ type: 'RESET_USER_NOTES' })\n        }}\n      />\n      {errorMsg}\n    </div>\n  )\n}\nInputDamjiroGakufu = connect()(InputDamjiroGakufu)\n\nfunction TimeOffsetForm ({ timeOffset, dispatch }) {\n  return (\n    <div>\n      <input\n        type='number'\n        value={Math.floor(timeOffset / 1000)}\n        onChange={e =>\n          dispatch({\n            type: 'SET_USER_TIME_OFFSET',\n            value: Number(e.target.value) * 1000\n          })\n        }\n        required\n      />\n      ms\n    </div>\n  )\n}\nTimeOffsetForm = connect(({ user: { timeOffset } }) => ({ timeOffset }))(\n  TimeOffsetForm\n)\n\nfunction PitchOffsetForm ({ pitchOffset, dispatch }) {\n  return (\n    <div>\n      <input\n        type='number'\n        value={Math.floor(pitchOffset)}\n        onChange={e =>\n          dispatch({\n            type: 'SET_USER_PITCH_OFFSET',\n            value: Number(e.target.value)\n          })\n        }\n        required\n      />\n      note#\n    </div>\n  )\n}\nPitchOffsetForm = connect(({ user: { pitchOffset } }) => ({ pitchOffset }))(\n  PitchOffsetForm\n)\n\nfunction NotesScroller ({\n  dispatch,\n  gakufu,\n  user: { notes: uNotes, timeOffset, pitchOffset }\n}) {\n  const playing = useRef(false)\n  const curTimeOffset = useRef(timeOffset)\n  const curPitchOffset = useRef(pitchOffset)\n  const [curtpos, setCurtpos] = useState(0)\n  const video = useRef(null)\n  const onPlay = useCallback(async () => {\n    if (playing.current) return\n    playing.current = true\n\n    // Set timer to scroll notes\n    const timerAdjust = setInterval(\n      () => setCurtpos(video.current.getCurrentTime() * 1000 * 1000),\n      25\n    )\n\n    // Create pitch detector\n    const [getPitch, stopAudio] = await createPitchDetector()\n\n    // Clear user's previous notes\n    dispatch({ type: 'RESET_USER_NOTES' })\n\n    // Loop to get pitches from mic\n    const getBiasedVideoTime = () =>\n      sec2us(video.current.getCurrentTime()) - curTimeOffset.current\n    let prev = getBiasedVideoTime()\n    while (playing.current) {\n      const pitch = await getPitch()\n      const now = getBiasedVideoTime()\n      if (pitch) {\n        const duration = now - prev\n        let biasedPitch = pitch\n        let correct = false\n\n        const lbIdx = lower_bound(gakufu.notes, n => n.tpos < prev) - 1\n        const lb = lbIdx >= 0 ? gakufu.notes[lbIdx] : gakufu.notes[0]\n        if (lb) {\n          biasedPitch = lb.pitch + curPitchOffset.current\n          let gap =\n            pitch - biasedPitch - Math.floor((pitch - biasedPitch) / 12) * 12\n          if (gap > 6) gap -= 12\n          biasedPitch += gap\n          if (lb.tpos < prev && prev < lb.tpos + lb.duration && gap === 0)\n            correct = true\n        }\n\n        const note = {\n          tpos: prev,\n          duration,\n          pitch: biasedPitch,\n          correct\n        }\n        dispatch({ type: 'APPEND_USER_NOTE', note })\n      }\n      prev = now\n    }\n    stopAudio()\n\n    // Stop timer\n    clearInterval(timerAdjust)\n  }, [gakufu.notes, dispatch])\n\n  curTimeOffset.current = timeOffset\n  curPitchOffset.current = pitchOffset\n\n  return (\n    <>\n      {gakufu.midiBuf && (\n        <MIDIPlayer\n          buffer={gakufu.midiBuf}\n          onReady={e => (video.current = e.target)}\n          onPlay={onPlay}\n          onEnd={() => (playing.current = false)}\n        />\n      )}\n\n      {gakufu.videoId && (\n        <YouTube\n          videoId={gakufu.videoId}\n          onReady={e => (video.current = e.target)}\n          onPlay={onPlay}\n          onPause={() => (playing.current = false)}\n          onEnd={() => (playing.current = false)}\n        />\n      )}\n\n      {gakufu.notes && (\n        <NotesDisplay\n          curtpos={curtpos}\n          gNotes={gakufu.notes}\n          uNotes={uNotes}\n          seconds={30}\n        />\n      )}\n    </>\n  )\n}\nNotesScroller = connect(({ gakufu, user }) => ({\n  gakufu,\n  user\n}))(NotesScroller)\n\nfunction ScoreDisplay ({ gNotes, uNotes }) {\n  if (!gNotes || !uNotes) return <div />\n\n  const percPitchCorrect =\n    uNotes.reduce((acc, uNote) => {\n      const gNote = gNotes[lower_bound(gNotes, n => n.tpos < uNote.tpos) - 1]\n      if (!gNote || gNote.tpos + gNote.duration < uNote.tpos) return acc\n      const loss = Math.abs(uNote.pitch - gNote.pitch)\n      const secretNonLinearFunc = x => x / (1 + Math.abs(x))\n      return acc + uNote.duration * (1 - secretNonLinearFunc(loss))\n    }, 0) / gNotes.reduce((sum, gNote) => sum + gNote.duration, 0)\n  const geta = 0\n  const scale = 1.2\n  const score = (percPitchCorrect * 100 + geta) * scale\n\n  return <div>Score: {Math.round(score * 100) / 100}</div>\n}\nScoreDisplay = connect(\n  ({ gakufu: { notes: gNotes }, user: { notes: uNotes } }) => ({\n    gNotes,\n    uNotes\n  })\n)(ScoreDisplay)\n\nfunction MIDIEditor ({ dispatch }) {\n  const [fileBody, setFileBody] = useState(null)\n  const [trackNo, setTrackNo] = useState(0)\n  const [channelNo, setChannelNo] = useState(0)\n  const [introTime, setIntroTime] = useState(0)\n  const [pitchOffset, setPitchOffset] = useState(0)\n  const [youtubeVideoId, setYoutubeVideoId] = useState(null)\n  const [video, setVideo] = useState(null)\n  const errorMsg = useRef(null)\n\n  let gNotesOriginal = []\n  let gNotes = []\n  if (fileBody) {\n    try {\n      gNotesOriginal = midi2notes(fileBody, trackNo, channelNo)\n      gNotes = makeNotesSensible(\n        gNotesOriginal,\n        introTime * 1000000,\n        pitchOffset\n      )\n      errorMsg.current = null\n    } catch (e) {\n      errorMsg.current = e.message\n    }\n  }\n\n  useEffect(() => {\n    if (gNotesOriginal.length === 0) return\n    const estimatedIntroTime = gNotesOriginal[0].tpos / 1000000\n    setIntroTime(estimatedIntroTime)\n  }, [fileBody, trackNo, channelNo])\n\n  useEffect(() => {\n    if (!video) return\n    video.seekTo(introTime, true)\n  }, [video, introTime])\n\n  return (\n    <div>\n      <div>\n        <input\n          type='file'\n          accept='audio/midi, audio/x-midi, audio/mid'\n          onChange={e => {\n            // Reset\n            setFileBody(null)\n            setTrackNo(0)\n            setChannelNo(0)\n            setIntroTime(0)\n            setPitchOffset(0)\n            setYoutubeVideoId(null)\n            setVideo(null)\n            errorMsg.current = null\n\n            // Read the file\n            const file = e.target.files[0]\n            MIDILoader(file, setFileBody, dispatch)\n          }}\n        />\n      </div>\n      <div>\n        <label>\n          Track No.:\n          <input\n            type='number'\n            onChange={e => setTrackNo(Number(e.target.value))}\n            value={trackNo}\n          />\n        </label>\n        <label>\n          Channel No.:\n          <input\n            type='number'\n            onChange={e => setChannelNo(Number(e.target.value))}\n            value={channelNo}\n          />\n        </label>\n      </div>\n      <div>\n        <label>\n          YouTube video id:\n          <input\n            type='text'\n            onChange={e => setYoutubeVideoId(e.target.value)}\n            value={youtubeVideoId || ''}\n          />\n        </label>\n      </div>\n      <div>\n        <label>\n          intro time (sec):\n          <input\n            type='number'\n            step='any'\n            onChange={e => setIntroTime(Number(e.target.value))}\n            value={introTime}\n          />\n        </label>\n        <label>\n          pitch offset (SMF note #):\n          <input\n            type='number'\n            onChange={e => setPitchOffset(Number(e.target.value))}\n            value={pitchOffset}\n          />\n        </label>\n      </div>\n      <div>\n        <textarea\n          value={\n            fileBody && youtubeVideoId\n              ? gakufu2json(gNotes, youtubeVideoId, 300 * 1000)\n              : ''\n          }\n          readOnly\n        />\n      </div>\n      <p>{errorMsg.current}</p>\n      {fileBody && youtubeVideoId ? (\n        <YouTube\n          videoId={youtubeVideoId}\n          onReady={e => {\n            const video = e.target\n            setVideo(video)\n            video.playVideo()\n            video.pauseVideo()\n          }}\n        />\n      ) : (\n        <div />\n      )}\n      <NotesDisplay curtpos={0} gNotes={gNotes} uNotes={[]} seconds={60} />\n    </div>\n  )\n}\nMIDIEditor = connect()(MIDIEditor)\n\nfunction gakufuReducer (\n  state = { notes: null, videoId: null, midiBuf: null },\n  action\n) {\n  switch (action.type) {\n    case 'SET_GAKUFU':\n      return action.gakufu\n\n    case 'RESET_GAKUFU':\n      return { notes: null, videoId: null }\n\n    default:\n      return state\n  }\n}\n\nfunction userReducer (\n  state = {\n    notes: [],\n    timeOffset: 300000,\n    pitchOffset: 0\n  },\n  action\n) {\n  switch (action.type) {\n    case 'SET_USER_TIME_OFFSET':\n      return {\n        ...state,\n        timeOffset: action.value\n      }\n\n    case 'SET_USER_PITCH_OFFSET':\n      return {\n        ...state,\n        pitchOffset: action.value\n      }\n\n    case 'RESET_USER_NOTES':\n      return {\n        ...state,\n        notes: []\n      }\n\n    case 'APPEND_USER_NOTE':\n      return {\n        ...state,\n        notes: state.notes.concat(action.note)\n      }\n\n    default:\n      return state\n  }\n}\n\nconst rootReducer = combineReducers({\n  gakufu: gakufuReducer,\n  user: persistReducer(\n    {\n      key: 'user',\n      storage,\n      whitelist: ['pitchOffset']\n    },\n    userReducer\n  ),\n  snack: snackbarReducer\n})\n\nconst persistedReducer = persistReducer(\n  {\n    key: 'root',\n    storage,\n    whitelist: ['user']\n  },\n  rootReducer\n)\n\nconst store = createStore(persistedReducer)\nconst persistor = persistStore(store)\n\nfunction App () {\n  return (\n    <Provider store={store}>\n      <PersistGate loading={null} persistor={persistor}>\n        <CssBaseline />\n        <InputDamjiroGakufu />\n        <MIDIFilePicker\n          onLoad={buf => {\n            store.dispatch({\n              type: 'SET_GAKUFU',\n              gakufu: {\n                notes: midi2notes(buf, 0, 0),\n                midiBuf: buf,\n                videoId: null\n              }\n            })\n          }}\n        />\n        <TimeOffsetForm />\n        <PitchOffsetForm />\n        <ScoreDisplay />\n        <NotesScroller />\n        <hr />\n        <MIDIEditor />\n        <MessageSnackbar />\n      </PersistGate>\n    </Provider>\n  )\n}\n\nexport default App\n","export default function snackbarReducer (\n  state = {\n    loadSnack: false,\n    message: '',\n    variant: ''\n  },\n  action\n) {\n  switch (action.type) {\n    case 'SNACK_LOAD':\n      console.log('loaded', action)\n      return {\n        ...state,\n        openSnack: true,\n        message: action.message,\n        variant: action.variant\n      }\n\n    case 'SNACK_UNLOAD':\n      console.log('unloaded', action)\n      return {\n        ...state,\n        openSnack: false\n      }\n\n    default:\n      return state\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\nexport function register (config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW (swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker (swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister () {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister()\n      })\n      .catch(error => {\n        console.error(error.message)\n      })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}