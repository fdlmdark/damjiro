(this.webpackJsonpdamjiro=this.webpackJsonpdamjiro||[]).push([[0],{151:function(e,t,a){e.exports=a(221)},156:function(e,t,a){},221:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(10),c=a.n(i),o=(a(156),a(29)),u=a(38),l=a(36),s=a.n(l),m=a(13),f=a(108),d=a(57),p=a(109),h=a(31),g=a(22),E=a(123),b=a(68),v=a(79),O=a(92),y=a.n(O),j=a(113),k=a(114),_=a.n(k),S=a(58),w=a.n(S),N=a(48),x=a.n(N),C=a(115),I=a(116),T=a(69),A=a(129),R=a(128),F=a(130),P=a(117),M=a.n(P),L=a(256),U=a(258),D=a(225);function B(e){var t=new w.a(e).getMidiEvents().filter((function(e){return e.subtype===x.a.EVENT_MIDI_NOTE_ON}));if(0===t.length)throw new Error("invalid midi file");return t[0]}var W=function(e){Object(A.a)(a,e);var t=Object(R.a)(a);function a(e,n){var r;return Object(C.a)(this,a),(r=t.call(this))._audioContext=e,r._pcm=n,r._playing=!1,r._currentTime=0,r._offset=0,r._epoch=null,r._onAudioProcess=r._onAudioProcess.bind(Object(T.a)(r)),r}return Object(I.a)(a,[{key:"play",value:function(){this._playing||(this._node=this._audioContext.createScriptProcessor(0,0,this._pcm.numChannels),this._node.connect(this._audioContext.destination),this._node.addEventListener("audioprocess",this._onAudioProcess),this._playing=!0,this.emit("start"))}},{key:"stop",value:function(){this._playing&&(this._node.disconnect(),this._node.removeEventListener("audioprocess",this._onAudioProcess),this._playing=!1,this._pcm=null,this.emit("end"))}},{key:"_onAudioProcess",value:function(e){for(var t=0,a=0;a<this._pcm.numChannels;a++){var n=e.outputBuffer.getChannelData(a);t=n.length;for(var r=0;r<t;r++){var i=(this._offset+r)*this._pcm.numChannels+a,c=i<this._pcm.data.length?this._pcm.data[i]/32767:0;n[r]=c}}this._offset+=t,this._epoch||(this._epoch=this._audioContext.currentTime),this._playing&&this._offset*this._pcm.numChannels>this._pcm.data.length&&this.stop()}},{key:"getCurrentTime",value:function(){return this._epoch?this._audioContext.currentTime-this._epoch:0}}]),a}(M.a);var K=function(e){var t=e.buffer,a=e.onReady,i=e.onPlay,c=e.onEnd,u=Object(n.useState)(null),l=Object(m.a)(u,2),f=l[0],p=l[1],h=Object(n.useState)(null),g=Object(m.a)(h,2),E=g[0],b=g[1],v=Object(n.useState)(!1),O=Object(m.a)(v,2),y=O[0],j=O[1],k=Object(n.useRef)(a),_=Object(n.useRef)(i),S=Object(n.useRef)(c),w=dt();return Object(n.useEffect)((function(){var e=new AudioContext;return p(e),function(){e.close()}}),[]),Object(n.useEffect)((function(){function e(){return(e=Object(d.a)(s.a.mark((function e(){var a,n,r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new F.a(window.location.pathname,"\nsoundfont GeneralUserGSv1.471.sf2\n",{sampleRate:f.sampleRate,numChannels:2});case 1:if(a.isReady()){e.next=6;break}return e.next=4,new Promise((function(e){return setTimeout(e,1e3)}));case 4:e.next=1;break;case 6:return e.next=8,a.midi2wav(new Uint8Array(t));case 8:n=e.sent,r=B(t).playTime/1e3*n.sampleRate*n.numChannels,(i=Object(o.a)({},n,{data:new Int16Array(r+n.data.length)})).data.set(n.data,r),c=new W(f,i),k.current&&k.current({target:c}),c.on("start",(function(){_.current&&_.current(),j(!0)})),c.on("end",(function(){S.current&&S.current(),j(!1)})),b((function(e){return e&&e.stop(),c}));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}f&&t&&function(){e.apply(this,arguments)}()}),[t,f]),k.current=a,_.current=i,S.current=c,r.a.createElement(r.a.Fragment,null,E&&!y?r.a.createElement(L.a,{size:"large",variant:"outlined",onClick:function(){return E.play()}},r.a.createElement(U.a,{className:w.wrapIcon}),"Play"):r.a.createElement(r.a.Fragment,null,!y&&r.a.createElement(D.a,{component:"subtitle"},"Loading...")))},G=function(e,t,a){try{if(["audio/midi","audio/x-midi","audio/mid"].includes(e.type)){var n=new FileReader;n.onload=function(e){return t(e.target.result)},n.readAsArrayBuffer(e)}else a({type:"SNACK_LOAD",message:"Invalid mime type",variant:"error"})}catch(r){a({type:"SNACK_LOAD",message:r.toString(),variant:"error"})}},V=a(289);function z(e){var t=e.onLoad,a=e.dispatch;return r.a.createElement(V.a,{type:"file",label:"Select a midi file.",accept:"audio/midi, audio/x-midi, audio/mid",onChange:function(e){var n=e.target.files[0];G(n,t,a)},InputLabelProps:{shrink:!0},variant:"outlined"})}var J=z=Object(g.b)()(z);var H=a(131),$=a(265),q=a(294),Y=a(267),Q=a(268),X=a(261),Z=a(262),ee=a(263),te=a(264),ae=a(269),ne=a(78),re=a(266),ie=a(4),ce={success:X.a,warning:Z.a,error:ee.a,info:te.a},oe=Object($.a)((function(e){return{success:{backgroundColor:ne.a[600]},error:{backgroundColor:e.palette.error.dark},info:{backgroundColor:e.palette.primary.main},warning:{backgroundColor:re.a[700]},icon:{fontSize:20},iconVariant:{opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"}}})),ue=Object(g.b)((function(e){var t=e.snack;return{openSnack:t.openSnack,variant:t.variant,message:t.message}}))((function(e){var t=e.openSnack,a=e.variant,n=e.message,i=e.dispatch,c=Object(H.a)(e,["openSnack","variant","message","dispatch"]),o=function(){return i({type:"SNACK_UNLOAD"})},u=oe();a=Object.keys(ce).includes(a)?a:"info";var l=ce[a];return r.a.createElement(q.a,Object.assign({anchorOrigin:{vertical:"bottom",horizontal:"center"},open:t,onClose:o},c),r.a.createElement(Y.a,{className:Object(ie.a)(u[a]),"aria-describedby":"snackbar",message:r.a.createElement("span",{id:"snackbar",className:u.message},r.a.createElement(l,{className:Object(ie.a)(u.icon,u.iconVariant)}),n),action:[r.a.createElement(Q.a,{key:"close","aria-label":"close",color:"inherit",onClick:o},r.a.createElement(ae.a,{className:u.icon}))]}))})),le=a(270),se=a(271),me=a(278),fe=a(279),de=a(75),pe=a(226),he=a(121),ge=a.n(he),Ee=a(275),be=a(274),ve=a(291),Oe=a(273),ye=a(276),je=a(277),ke=a(272),_e=a(290);function Se(e,t,a){var n={notes:e.map((function(e){return[Math.round(e.tpos),Math.round(e.duration),Math.round(e.pitch)]})),youtubeVideoId:t,timeOffset:a};return JSON.stringify(n)}var we=ge()({alternativeLabel:{top:22},active:{"& $line":{backgroundImage:"linear-gradient( 136deg, #000046 0%, #1CB5E0 80%)"}},completed:{"& $line":{backgroundImage:"linear-gradient( 136deg, #000046 0%, #1CB5E0 80%)"}},line:{height:3,border:0,backgroundColor:"#eaeaf0",borderRadius:1}})(pe.a),Ne=Object($.a)({root:{backgroundColor:"#cccccc",zIndex:1,color:"#ffffff",width:50,height:50,display:"flex",borderRadius:"50%",justifyContent:"center",alignItems:"center"},active:{backgroundImage:"linear-gradient( 136deg, #1CB5E0 20%, #000046 100%)",boxShadow:"0 4px 10px 0 rgba(0,0,0,.25)"},completed:{backgroundImage:"linear-gradient( 136deg, #1CB5E0 20%, #000046 100%)"},font:{fontSize:"24px"}});function xe(e){var t,a=Ne(),n=e.active,i=e.completed,c={1:r.a.createElement(de.a,{icon:["far","file-audio"],fontSize:500}),2:r.a.createElement(le.a,null),3:r.a.createElement(se.a,null)};return r.a.createElement("div",{className:Object(ie.a)(a.root,(t={},Object(u.a)(t,a.active,n),Object(u.a)(t,a.completed,i),t),a.font)},c[String(e.icon)])}var Ce=Object($.a)((function(e){return{root:{width:"100%"},button:{marginRight:e.spacing(1)},videoFrame:{width:"640px",height:"360px"}}}));function Ie(e){var t=e.dispatch,a=Ce(),i=Object(n.useState)(0),c=Object(m.a)(i,2),o=c[0],u=c[1],l=["Select midi file","Input youtube Id","Check output Gakufu"],s=Object(n.useState)(""),f=Object(m.a)(s,2),d=f[0],p=f[1],h=Object(n.useState)(0),g=Object(m.a)(h,2),E=g[0],v=g[1],O=Object(n.useState)(0),y=Object(m.a)(O,2),j=y[0],k=y[1],_=Object(n.useState)(0),S=Object(m.a)(_,2),w=S[0],N=S[1],x=Object(n.useState)(0),C=Object(m.a)(x,2),I=C[0],T=C[1],A=Object(n.useState)(""),R=Object(m.a)(A,2),F=R[0],P=R[1],M=Object(n.useState)(null),U=Object(m.a)(M,2),B=U[0],W=U[1],K=Object(n.useRef)(""),z=[],J=[];if(d)try{z=Qe(d,E,j),J=function(e,t,a){if(0===e.length)return e;var n=e[0].tpos;return e.map((function(e){return{tpos:e.tpos-n+t,duration:e.duration,pitch:e.pitch+a}}))}(z,1e6*w,I),K.current=null}catch(H){K.current=H.message}return Object(n.useEffect)((function(){if(0!==z.length){var e=z[0].tpos/1e6;N(e)}}),[d,E,j]),Object(n.useEffect)((function(){B&&B.seekTo(w,!0)}),[B,w]),r.a.createElement("div",{className:a.root},r.a.createElement(be.a,{alternativeLabel:!0,activeStep:o,connector:r.a.createElement(we,null)},l.map((function(e){return r.a.createElement(Ee.a,{key:e},r.a.createElement(ve.a,{StepIconComponent:xe},e))}))),r.a.createElement("div",null,o===l.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(ye.a,null,r.a.createElement(D.a,{className:a.instructions},"Let's sing with your Gakufu!")),r.a.createElement(je.a,null,r.a.createElement(L.a,{onClick:function(){u(0)},className:a.button},"Reset"))):r.a.createElement("div",null,r.a.createElement(ye.a,null,function(e){switch(e){case 0:return r.a.createElement(ke.a,{container:!0,direction:"column",justify:"center",alignItems:"center",spacing:2},r.a.createElement(ke.a,{item:!0,container:!0,direction:"row",justify:"center",spacing:2},r.a.createElement(ke.a,{item:!0},r.a.createElement(V.a,{fullWidth:!0,type:"file",accept:"audio/midi, audio/x-midi, audio/mid",InputLabelProps:{shrink:!0},variant:"outlined",onChange:function(e){p(""),v(0),k(0),N(0),T(0),P(""),W(null),K.current="";var a=e.target.files[0];G(a,p,t)},label:"Select a midi file."})),r.a.createElement(Oe.a,{orientation:"vertical",flexItem:!0}),r.a.createElement(ke.a,{item:!0},r.a.createElement(V.a,{label:"Track No.",type:"number",onChange:function(e){return v(Number(e.target.value))},value:E,InputLabelProps:{shrink:!0},variant:"outlined"})),r.a.createElement(ke.a,{item:!0},r.a.createElement(V.a,{label:"Channel No.",type:"number",onChange:function(e){return k(Number(e.target.value))},value:j,InputLabelProps:{shrink:!0},variant:"outlined"})),r.a.createElement(ke.a,{item:!0},r.a.createElement(V.a,{label:"pitch offset (SMF note #)",type:"number",onChange:function(e){return T(Number(e.target.value))},value:I,InputLabelProps:{shrink:!0},variant:"outlined"}))),r.a.createElement(ke.a,{item:!0},r.a.createElement(tt,{curtpos:0,gNotes:J,uNotes:[],seconds:60})));case 1:return r.a.createElement(ke.a,{container:!0,direction:"row",wrap:"wrap",justify:"space-around",spacing:2},r.a.createElement(ke.a,{item:!0,style:{maxWidth:"300px"},xl:3,lg:12,container:!0,direction:"column",spacing:2},r.a.createElement(ke.a,{item:!0},r.a.createElement(V.a,{fullWidth:!0,label:"YouTube video id",type:"text",onChange:function(e){return P(String(e.target.value))},InputLabelProps:{shrink:!0},variant:"outlined"})),r.a.createElement(ke.a,{item:!0},r.a.createElement(V.a,{fullWidth:!0,label:"intro time (sec)",type:"number",step:"any",onChange:function(e){return N(Number(e.target.value))},value:w,InputLabelProps:{shrink:!0},variant:"outlined"}))),r.a.createElement(_e.a,{mdDown:!0},r.a.createElement(Oe.a,{orientation:"vertical",flexItem:!0})),r.a.createElement(ke.a,{item:!0,style:{maxWidth:"640px"},xl:9,lg:12},F?r.a.createElement(b.a,{videoId:F,onReady:function(e){var t=e.target;W(t),t.playVideo(),t.pauseVideo()}}):r.a.createElement("div",{className:a.videoFrame})));case 2:return r.a.createElement(ke.a,{item:!0,container:!0,direction:"row",justify:"center",spacing:3},r.a.createElement(ke.a,{item:!0,xs:10},r.a.createElement(V.a,{fullWidth:!0,multiline:!0,rows:8,label:"Output Gakufu",value:d&&F?Se(J,F,3e5):"",readOnly:!0,InputLabelProps:{shrink:!0},variant:"outlined"})),r.a.createElement(ke.a,{item:!0},r.a.createElement(D.a,null,K.current)));default:return void t({type:"SNACK_LOAD",message:"Unknown step Error",variant:"error"})}}(o)),r.a.createElement(je.a,null,r.a.createElement(ke.a,{container:!0,direction:"row",justify:"space-around"},r.a.createElement(ke.a,{item:!0},r.a.createElement(L.a,{disabled:0===o,onClick:function(){u((function(e){return e-1}))},className:a.button},r.a.createElement(me.a,null),"Back")),r.a.createElement(ke.a,{item:!0},r.a.createElement(L.a,{variant:"contained",color:"primary",onClick:function(){u((function(e){return e+1}))},className:a.button,disabled:function(e){switch(e){case 0:return!d;case 1:return!F;case 2:return!1;default:return!0}}(o)},o===l.length-1?"Finish":"Next",r.a.createElement(fe.a,null))))))))}var Te=Ie=Object(g.b)()(Ie),Ae=a(288),Re=a(259),Fe=a(292),Pe=a(293),Me=a(281),Le=a(285),Ue=a(127),De=a.n(Ue),Be=a(280),We=a(287),Ke=a(282),Ge=a(283),Ve=a(284),ze=a(286),Je=a(60),He=a(122);function $e(){var e=Object(f.a)(["\n  width: 80vw;\n  height: 80vh;\n"]);return $e=function(){return e},e}function qe(e,t){return Math.floor(e/t)*t}function Ye(e,t){return function(a,n){for(var r=n-a;0!==r;){var i=Math.floor(r/2),c=a+i;t(e[c])?(r-=i+1,a=c+1):r=i}return a}(0,e.length)}function Qe(e,t,a){var n=new w.a(e);if(2===n.header.getFormat())throw new Error("Unsupported format of MIDI");if(0===n.header.getTracksCount())throw new Error("Not enough tracks");if(n.header.getTimeDivision()!==w.a.Header.TICKS_PER_BEAT)throw new Error("Unsupported time division");var r,i=[],c=[],o=n.getMidiEvents(),u=Object(p.a)(o);try{for(u.s();!(r=u.n()).done;){var l=r.value;if(l.channel===a)switch(l.subtype){case x.a.EVENT_MIDI_NOTE_ON:if(i.length!==c.length)break;i.push([1e3*l.playTime,l.param1]);break;case x.a.EVENT_MIDI_NOTE_OFF:if(i.length-c.length!==1||i[i.length-1][1]!==l.param1)break;c.push([1e3*l.playTime,l.param1])}}}catch(h){u.e(h)}finally{u.f()}if(i.length!==c.length)throw new Error("Invalid # of note offs");for(var s=[],m=0;m<i.length;m++){var f=i[m],d=c[m];s.push({tpos:f[0],duration:d[0]-f[0],pitch:f[1]})}return s}function Xe(){return Ze.apply(this,arguments)}function Ze(){return(Ze=Object(d.a)(s.a.mark((function e(){var t,a,n,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AudioContext,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 3:return a=e.sent,e.next=6,new Promise((function(e){var n=_.a.pitchDetection("./model",t,a,(function(){e(n)}))}));case 6:return n=e.sent,r=function(){return new Promise((function(e,t){return n.getPitch((function(a,n){a&&t(a),n||e(null);var r=Math.round(Math.log(n/440)/Math.log(2)*12)+69;e(r)}))}))},i=function(){a.getTracks().forEach((function(e){return e.stop()})),t.close()},e.abrupt("return",[r,i]);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Je.b.add(He.a);var et=E.a.svg($e());function tt(e){var t,a,n,i=e.curtpos,c=e.gNotes,o=e.uNotes,u=e.seconds,l=100*u,s=function(e){return 100*e/1e6},m=qe(s(i),l),f=qe(s(i),l)+l,d=function(e){return s(e)-m},p=function(e,t){return e.filter((function(e){return m<s(e.tpos+e.duration)&&s(e.tpos)<f})).reduce((function(e,t){if(0===e.length)return[t];var a,n,r=e[e.length-1];return r.pitch===t.pitch&&(a=r.tpos+r.duration,n=t.tpos,Math.abs(a-n)<1e-4)?(e[e.length-1]={tpos:r.tpos,duration:t.tpos+t.duration-r.tpos,pitch:r.pitch},e):e.concat(t)}),[]).map((function(e){return r.a.createElement(r.a.Fragment,{key:e.tpos},r.a.createElement("rect",{x:d(e.tpos),y:500-5*e.pitch,width:s(e.duration),height:5,rx:1,ry:1,fill:t,fillOpacity:.7}))}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,i),r.a.createElement(et,{viewBox:"0,0,"+l+",500",preserveAspectRatio:"none"},r.a.createElement("line",{x1:0,x2:l,y1:0,y2:0,strokeWidth:5,stroke:"gray"}),r.a.createElement("line",{x1:0,x2:l,y1:500,y2:500,strokeWidth:5,stroke:"gray"}),(t=0,a=l,n=100,Array.from({length:(a-t)/n+1},(function(e,a){return t+a*n}))).map((function(e){return r.a.createElement("line",{key:e,x1:e,x2:e,y1:0,y2:500,strokeWidth:1,stroke:"gray",fillOpacity:.7})})),r.a.createElement("line",{x1:d(i),x2:d(i),y1:0,y2:500,strokeWidth:1,stroke:"red"}),p(c,"gray"),p(o.filter((function(e){return e.correct})),"#FFA500"),p(o.filter((function(e){return!e.correct})),"red")))}function at(e){var t=e.dispatch,a=Object(n.useState)(""),i=Object(m.a)(a,2),c=i[0],o=i[1],u=Object(n.useState)(null),l=Object(m.a)(u,2),s=l[0],f=l[1];return r.a.createElement(Fe.a,{fullWidth:!0},r.a.createElement(V.a,{value:c,label:"Enter Damjiro Gakuhu.",helperText:s,error:s,multiline:!0,rows:3,InputLabelProps:{shrink:!0},variant:"outlined",onChange:function(e){var a;if(t({type:"RESET_USER_NOTES"}),o(e.target.value),""!==e.target.value)try{var n=JSON.parse(e.target.value),r=n.notes.map((function(e){return{tpos:e[0],duration:e[1],pitch:e[2]}})),i=n.youtubeVideoId,c=n.timeOffset;!("string"===typeof(a=i)||a instanceof String)||isNaN(c)?t({type:"SNACK_LOAD",message:"invalid JSON",variant:"error"}):(t({type:"SET_GAKUFU",gakufu:{notes:r,videoId:i}}),t({type:"SET_USER_TIME_OFFSET",value:c}),f(null))}catch(e){t({type:"RESET_GAKUFU"}),f(e.message),t({type:"SNACK_LOAD",message:e.message,variant:"error"})}else f(null)}}))}function nt(e){var t=e.timeOffset,a=e.dispatch;return r.a.createElement(Fe.a,{fullWidth:!0},r.a.createElement(Pe.a,null,"Offset"),r.a.createElement(Re.a,{type:"number",value:Math.floor(t/1e3),onChange:function(e){return a({type:"SET_USER_TIME_OFFSET",value:1e3*Number(e.target.value)})},required:!0,endAdornment:r.a.createElement(Be.a,{position:"end"},"ms")}))}function rt(e){var t=e.pitchOffset,a=e.dispatch;return r.a.createElement(Fe.a,{fullWidth:!0},r.a.createElement(Pe.a,null,"Pitch Offset"),r.a.createElement(Re.a,{type:"number",value:Math.floor(t),onChange:function(e){return a({type:"SET_USER_PITCH_OFFSET",value:Number(e.target.value)})},required:!0,endAdornment:r.a.createElement(Be.a,{position:"end"},"note#")}))}function it(e){var t=e.dispatch,a=e.gakufu,i=e.user,c=i.notes,o=i.timeOffset,u=i.pitchOffset,l=pt(),f=Object(n.useRef)(!1),p=Object(n.useRef)(o),h=Object(n.useRef)(u),g=Object(n.useState)(0),E=Object(m.a)(g,2),v=E[0],O=E[1],y=Object(n.useRef)(null),j=Object(n.useCallback)(Object(d.a)(s.a.mark((function e(){var n,r,i,c,o,u,l,d,g,E,b,v,j,k,_;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f.current){e.next=2;break}return e.abrupt("return");case 2:return f.current=!0,n=setInterval((function(){return O(1e3*y.current.getCurrentTime()*1e3)}),25),e.next=6,Xe();case 6:r=e.sent,i=Object(m.a)(r,2),c=i[0],o=i[1],t({type:"RESET_USER_NOTES"}),l=(u=function(){return 1e6*y.current.getCurrentTime()-p.current})();case 13:if(!f.current){e.next=22;break}return e.next=16,c();case 16:d=e.sent,g=u(),d&&d>=36&&d<=88&&(E=g-l,b=d,v=!1,j=Ye(a.notes,(function(e){return e.tpos<l}))-1,(k=j>=0?a.notes[j]:a.notes[0])&&(b=k.pitch+h.current,(_=d-b-12*Math.floor((d-b)/12))>6&&(_-=12),b+=_,k.tpos<l&&l<k.tpos+k.duration&&0===_&&(v=!0)),t({type:"APPEND_USER_NOTE",note:{tpos:l,duration:E,pitch:b,correct:v}})),l=g,e.next=13;break;case 22:o(),clearInterval(n);case 24:case"end":return e.stop()}}),e)}))),[a.notes,t]);return p.current=o,h.current=u,r.a.createElement(r.a.Fragment,null,a.videoId&&r.a.createElement(b.a,{videoId:a.videoId,onReady:function(e){return y.current=e.target},onPlay:j,onPause:function(){return f.current=!1},onEnd:function(){return f.current=!1}}),a.notes&&r.a.createElement(ke.a,{container:!0,direction:"row",wrap:"wrap",alignItems:"flex-end"},r.a.createElement(ke.a,{item:!0,className:l.mr2},r.a.createElement(tt,{curtpos:v,gNotes:a.notes,uNotes:c,seconds:30})),r.a.createElement(ke.a,{item:!0,className:[l.mr2,l.mt1],style:{maxWidth:"140px"},container:!0,direction:"column",spacing:2},r.a.createElement(ke.a,{item:!0},a.midiBuf&&r.a.createElement(K,{buffer:a.midiBuf,onReady:function(e){return y.current=e.target},onPlay:j,onEnd:function(){return f.current=!1}})),r.a.createElement(ke.a,{item:!0},r.a.createElement(ct,null)))))}function ct(e){var t=e.gNotes,a=e.uNotes;if(!t||!a)return r.a.createElement("div",null);var n=1.2*(100*(a.reduce((function(e,a){var n=t[Ye(t,(function(e){return e.tpos<a.tpos}))-1];if(!n||n.tpos+n.duration<a.tpos)return e;var r,i=Math.abs(a.pitch-n.pitch);return e+a.duration*(1-(r=i)/(1+Math.abs(r)))}),0)/t.reduce((function(e,t){return e+t.duration}),0))+0),i=100*(a.reduce((function(e,a){var n=t[Ye(t,(function(e){return e.tpos<a.tpos}))-1];if(!n||n.tpos+n.duration<a.tpos)return e;Math.abs(a.pitch-n.pitch);return a.pitch===n.pitch?e+a.duration:e}),0)/a.reduce((function(e,t){return e+t.duration}),0));return r.a.createElement("div",null,r.a.createElement(D.a,{variant:"h6"},"Score: ",Math.round(100*n)/100," Accuracy:"," ",Math.round(100*i)/100))}function ot(){var e=dt(),t=pt(),a=r.a.useState(!1),n=Object(m.a)(a,2),i=n[0],c=n[1];return r.a.createElement(Me.a,{className:t.m1},r.a.createElement(ye.a,null,r.a.createElement(D.a,{variant:"h5"},r.a.createElement(Ke.a,{className:e.wrapIcon}),"Sing a song"),r.a.createElement(ke.a,{className:t.mt2,container:!0,direction:"row",justify:"space-around"},r.a.createElement(ke.a,{item:!0,xs:5},r.a.createElement(D.a,{variant:"h6",className:t.mb2,color:"textSecondary"},r.a.createElement(Ge.a,{className:e.wrapIcon}),"From Damjiro Gakufu file."),r.a.createElement(at,null)),r.a.createElement(Oe.a,{orientation:"vertical",flexItem:!0}),r.a.createElement(ke.a,{item:!0,xs:5,container:!0,direction:"column",justify:"space-between"},r.a.createElement(D.a,{variant:"h6",color:"textSecondary"},r.a.createElement(de.a,{icon:["far","file-audio"],className:e.wrapIcon}),"From midi file."),r.a.createElement(J,{onLoad:function(e){mt.dispatch({type:"SET_GAKUFU",gakufu:{notes:Qe(e,0,0),midiBuf:e,videoId:null}})}})))),r.a.createElement(ye.a,null,r.a.createElement(it,null)),r.a.createElement(je.a,{disableSpacing:!0},r.a.createElement(D.a,{color:"textSecondary",className:t.ml1},r.a.createElement(Ve.a,{className:e.wrapIcon}),"Adjustment"),r.a.createElement(Q.a,{className:Object(ie.a)(e.expand,Object(u.a)({},e.expandOpen,i)),onClick:function(){c(!i)},"aria-expanded":i,"aria-label":"show more"},r.a.createElement(De.a,null))),r.a.createElement(Le.a,{in:i,timeout:"auto",unmountOnExit:!0},r.a.createElement(ke.a,{container:!0,spacing:5,direction:"row",className:t.collapse},r.a.createElement(ke.a,{item:!0,xs:3},r.a.createElement(nt,null)),r.a.createElement(ke.a,{item:!0,xs:3},r.a.createElement(rt,null)))))}at=Object(g.b)()(at),nt=Object(g.b)((function(e){return{timeOffset:e.user.timeOffset}}))(nt),rt=Object(g.b)((function(e){return{pitchOffset:e.user.pitchOffset}}))(rt),it=Object(g.b)((function(e){return{gakufu:e.gakufu,user:e.user}}))(it),ct=Object(g.b)((function(e){return{gNotes:e.gakufu.notes,uNotes:e.user.notes}}))(ct);var ut=function(){var e=dt(),t=pt();return r.a.createElement(Me.a,{className:t.m1},r.a.createElement(ye.a,null,r.a.createElement(D.a,{variant:"h5"},r.a.createElement(ze.a,{className:e.wrapIcon}),"Make Damjiro Gakuhu.")),r.a.createElement(Te,null))};var lt=Object(h.b)({gakufu:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{notes:null,videoId:null,midiBuf:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_GAKUFU":return t.gakufu;case"RESET_GAKUFU":return{notes:null,videoId:null};default:return e}},user:Object(v.a)({key:"user",storage:y.a,whitelist:["pitchOffset"]},(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{notes:[],timeOffset:3e5,pitchOffset:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER_TIME_OFFSET":return Object(o.a)({},e,{timeOffset:t.value});case"SET_USER_PITCH_OFFSET":return Object(o.a)({},e,{pitchOffset:t.value});case"RESET_USER_NOTES":return Object(o.a)({},e,{notes:[]});case"APPEND_USER_NOTE":return Object(o.a)({},e,{notes:e.notes.concat(t.note)});default:return e}})),snack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loadSnack:!1,message:"",variant:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SNACK_LOAD":return console.log("loaded",t),Object(o.a)({},e,{openSnack:!0,message:t.message,variant:t.variant});case"SNACK_UNLOAD":return console.log("unloaded",t),Object(o.a)({},e,{openSnack:!1});default:return e}}}),st=Object(v.a)({key:"root",storage:y.a,whitelist:["user"]},lt),mt=Object(h.c)(st),ft=Object(v.b)(mt),dt=Object($.a)((function(e){return{expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"},wrapIcon:{verticalAlign:"middle",display:"inline-flex",marginRight:e.spacing(1)}}})),pt=Object($.a)((function(e){return{mt1:{marginTop:e.spacing(1)},mt2:{marginTop:e.spacing(2)},mt3:{marginTop:e.spacing(3)},mb1:{marginBottom:e.spacing(1)},mb2:{marginBottom:e.spacing(2)},m1:{margin:e.spacing(1)},m3:{margin:e.spacing(3)},ml1:{marginLeft:e.spacing(1)},collapse:{marginLeft:e.spacing(3),marginRight:e.spacing(3),marginBottom:e.spacing(3)},mr2:{marginRight:e.spacing(2)}}}));var ht=function(){var e=pt();return r.a.createElement(g.a,{store:mt},r.a.createElement(j.a,{loading:null,persistor:ft},r.a.createElement(We.a,null),r.a.createElement(Ae.a,{maxWidth:!1},r.a.createElement(D.a,{variant:"h4",className:e.m1},"Damjiro"),r.a.createElement(ot,null),r.a.createElement(ut,null)),r.a.createElement(ue,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ht,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[151,1,2]]]);
//# sourceMappingURL=main.b91cbefb.chunk.js.map